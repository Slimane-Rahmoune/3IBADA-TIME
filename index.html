
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª + ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Tahoma, Arial; background:#eef6ff; margin:14px; direction:rtl; }
    h2, h3 { text-align:center; color:#1b2a41; }
    .card { background:white; padding:12px; margin:10px 0; border-radius:10px; box-shadow:0 1px 4px rgba(0,0,0,0.1); }
    .task { padding:8px; border-bottom:1px solid #f0f0f0; display:flex; justify-content:space-between; align-items:center; }
    .task:last-child { border-bottom:none; }
    .done { text-decoration: line-through; color:gray; }
    button, input[type="time"] { padding:8px 10px; border-radius:8px; border:1px solid #cfd8e3; background:#fff; }
    button { cursor:pointer; }
    .primary { background:#1e88e5; color:white; border:none; }
    .muted { color:#5f6b7a; font-size:12px; }
    label { display:block; margin:6px 0 4px; }
    .row { display:flex; flex-wrap:wrap; gap:10px; }
    .col { flex:1; min-width:180px; }
    .tiny { font-size:12px; color:#6d7a89; }
    .switch { position: relative; display: inline-block; width: 44px; height: 24px; vertical-align:middle;}
    .switch input {display:none;}
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .2s; border-radius:24px;}
    .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .2s; border-radius:50%;}
    input:checked + .slider { background-color: #1e88e5;}
    input:checked + .slider:before { transform: translateX(20px); }
    .header-actions { display:flex; justify-content:center; gap:10px; margin-bottom:10px; }
  </style>
</head>
<body>
  <h2>ğŸ•°ï¸ Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª Ø¹Ù„Ù‰ Ù…Ù†Ù‡Ø¬ Ø§Ù„Ù†Ø¨ÙŠ ï·º</h2>

  <div class="header-actions">
    <button class="primary" id="btnNotify">ğŸ”” ÙØ¹Ù‘Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
    <button id="btnInstall">â¬‡ï¸ Ø£Ø¶ÙÙ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <span class="tiny">Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ¹Ù…Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø¨Ù‚Ø§Ø¦Ù‡Ø§ Ø¨Ø§Ù„Ø®Ù„ÙÙŠØ© ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª.</span>
  </div>

  <div class="card" id="tasksCard">
    <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙˆÙ…</h3>
    <div id="tasks"></div>
  </div>

  <div class="card">
    <h3>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Ø§Ø¶Ø¨Ø· Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø­Ø³Ø¨ Ù…Ø¯ÙŠÙ†ØªÙƒ)</h3>
    <div class="row" id="reminders"></div>
    <div style="margin-top:10px; text-align:center;">
      <button class="primary" id="saveTimes">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©</button>
      <div class="muted" id="status"></div>
    </div>
    <p class="tiny">ØªÙ„Ù…ÙŠØ­: ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªØ·Ø¨ÙŠÙ‚ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØªØŒ Ø«Ù… Ø¶Ø¹Ù‡Ø§ Ù‡Ù†Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§.</p>
  </div>

  <script>
    // --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù… ---
    const TASKS = [
      {key:"qiyam", name:"Ù‚Ø¨Ù„ Ø§Ù„ÙØ¬Ø±", action:"Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„ ÙˆØ°ÙƒØ± Ø§Ù„Ù„Ù‡", default:"04:30"},
      {key:"fajr", name:"Ø§Ù„ÙØ¬Ø± â€“ Ø§Ù„Ø´Ø±ÙˆÙ‚", action:"ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± + Ø°ÙƒØ± ÙˆÙ‚Ø±Ø¢Ù†", default:"05:30"},
      {key:"sabah", name:"Ø§Ù„ØµØ¨Ø§Ø­", action:"Ø¹Ù…Ù„/Ø¯Ø±Ø§Ø³Ø© Ø¨Ù†ÙŠÙ‘Ø© Ù„Ù„Ù‡", default:"08:00"},
      {key:"duha", name:"Ø§Ù„Ø¶Ø­Ù‰", action:"Ø±ÙƒØ¹ØªØ§Ù† Ø£Ùˆ Ø£Ø±Ø¨Ø¹", default:"10:30"},
      {key:"dhuhr", name:"Ø§Ù„Ø¸Ù‡Ø±", action:"ØµÙ„Ø§Ø© + Ù‚ÙŠÙ„ÙˆÙ„Ø©", default:"13:30"},
      {key:"asr", name:"Ø§Ù„Ø¹ØµØ± â€“ Ø§Ù„Ù…ØºØ±Ø¨", action:"Ø¹Ù…Ù„/Ø¹Ù„Ù… + Ø±ÙŠØ§Ø¶Ø©", default:"17:00"},
      {key:"maghrib", name:"Ø§Ù„Ù…ØºØ±Ø¨ â€“ Ø§Ù„Ø¹Ø´Ø§Ø¡", action:"Ø¬Ù„Ø³Ø© Ø¹Ø§Ø¦Ù„ÙŠØ© + Ù‚Ø±Ø¢Ù†", default:"20:00"},
      {key:"isha", name:"Ø§Ù„Ø¹Ø´Ø§Ø¡", action:"ØµÙ„Ø§Ø© + Ø±Ø§Ø­Ø©/Ù…Ø·Ø§Ù„Ø¹Ø©", default:"21:30"},
      {key:"night", name:"Ø§Ù„Ù„ÙŠÙ„", action:"Ù†ÙˆÙ… Ù…Ø¨ÙƒØ± + Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„", default:"23:00"}
    ];

    // --- Ø±Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ---
    const tasksDiv = document.getElementById('tasks');
    TASKS.forEach((t,i)=>{
      const row = document.createElement('div');
      row.className = 'task';
      row.innerHTML = \`
        <div>
          <b>\${t.name}:</b> <span id="txt\${t.key}">\${t.action}</span>
        </div>
        <div>
          <button onclick="toggleDone('\${t.key}')">âœ…</button>
        </div>
      \`;
      tasksDiv.appendChild(row);
    });

    function toggleDone(key){
      document.getElementById('txt'+key).classList.toggle('done');
      // Ø­ÙØ¸ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ… (ÙŠÙˆÙ…ÙŠÙ‹Ø§)
      const dayKey = new Date().toISOString().slice(0,10);
      const done = JSON.parse(localStorage.getItem('done_'+dayKey) || '{}');
      done[key] = document.getElementById('txt'+key).classList.contains('done');
      localStorage.setItem('done_'+dayKey, JSON.stringify(done));
    }

    // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    (function restoreDone(){
      const dayKey = new Date().toISOString().slice(0,10);
      const done = JSON.parse(localStorage.getItem('done_'+dayKey) || '{}');
      Object.keys(done).forEach(k=>{
        if(done[k]) document.getElementById('txt'+k).classList.add('done');
      });
    })();

    // --- Ù‚Ø³Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ---
    const remindersDiv = document.getElementById('reminders');
    function loadTimes(){
      const saved = JSON.parse(localStorage.getItem('times') || '{}');
      remindersDiv.innerHTML = '';
      TASKS.forEach(t=>{
        const val = saved[t.key] || t.default;
        const enabled = (saved[t.key+'_en'] !== undefined) ? !!saved[t.key+'_en'] : true;
        const col = document.createElement('div');
        col.className = 'col';
        col.innerHTML = \`
          <label><b>\${t.name}</b></label>
          <input type="time" id="time_\${t.key}" value="\${val}">
          <label class="tiny">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
            <span class="switch">
              <input type="checkbox" id="en_\${t.key}" \${enabled ? 'checked' : ''}>
              <span class="slider"></span>
            </span>
          </label>
        \`;
        remindersDiv.appendChild(col);
      });
    }
    loadTimes();

    document.getElementById('saveTimes').addEventListener('click', ()=>{
      const data = {};
      TASKS.forEach(t=>{
        data[t.key] = document.getElementById('time_'+t.key).value || t.default;
        data[t.key+'_en'] = document.getElementById('en_'+t.key).checked;
      });
      localStorage.setItem('times', JSON.stringify(data));
      cancelAllSchedules();
      scheduleAll();
      setStatus('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª');
    });

    function setStatus(msg){
      document.getElementById('status').textContent = msg;
      setTimeout(()=> document.getElementById('status').textContent = '', 4000);
    }

    // --- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ ---
    function notify(title, body){
      if ('Notification' in window && Notification.permission === 'granted'){
        new Notification(title, { body });
      } else {
        alert(title + "\n" + body);
      }
    }

    document.getElementById('btnNotify').addEventListener('click', async ()=>{
      if (!('Notification' in window)){
        alert('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª. Ø³ÙŠÙØ³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© ÙÙ‚Ø·.');
        return;
      }
      let perm = Notification.permission;
      if (perm !== 'granted'){
        try {
          perm = await Notification.requestPermission();
        } catch(e){}
      }
      if (perm === 'granted'){
        notify('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª âœ…','Ø³ØªØªÙ„Ù‚Ù‰ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.');
        scheduleAll();
      } else {
        alert('Ù„Ù… ØªÙÙØ¹Ù‘Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­. Ø³Ù†Ø³ØªØ®Ø¯Ù… ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© ÙÙ‚Ø·.');
      }
    });

    // --- Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Ø·Ø§Ù„Ù…Ø§ Ø§Ù„ØµÙØ­Ø© Ù…ÙØªÙˆØ­Ø©/ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©) ---
    const timers = [];
    function cancelAllSchedules(){
      while(timers.length){
        const id = timers.pop();
        clearTimeout(id);
      }
    }

    function parseTimeToTodayHHMM(str){
      const [h,m] = str.split(':').map(x=>parseInt(x,10));
      const now = new Date();
      const t = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0, 0);
      return t;
    }

    function msUntilNext(timeStr){
      const now = new Date();
      let t = parseTimeToTodayHHMM(timeStr);
      if (t <= now){ // Ù…Ø±Ù‘ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ… -> ØºØ¯Ù‹Ø§
        t = new Date(t.getTime() + 24*60*60*1000);
      }
      return t.getTime() - now.getTime();
    }

    function scheduleOne(t){
      const saved = JSON.parse(localStorage.getItem('times') || '{}');
      const timeStr = saved[t.key] || t.default;
      const enabled = (saved[t.key+'_en'] !== undefined) ? !!saved[t.key+'_en'] : true;
      if (!enabled) return;
      const ms = msUntilNext(timeStr);
      const id = setTimeout(()=>{
        notify('â° ØªÙ†Ø¨ÙŠÙ‡: '+t.name, t.action);
        // Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ØŒ Ø£Ø¹Ø¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ù„Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
        scheduleOne(t);
      }, ms);
      timers.push(id);
    }

    function scheduleAll(){
      TASKS.forEach(scheduleOne);
    }

    // Ø¬Ø¯ÙˆÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª Ù…ÙØ¹Ù‘Ù„Ø©
    if ('Notification' in window && Notification.permission === 'granted'){
      scheduleAll();
    }

    // --- Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (PWA Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù… Ø®Ø§Ø±Ø¬ÙŠ) ---
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('btnInstall').style.display = 'inline-block';
    });

    document.getElementById('btnInstall').addEventListener('click', async ()=>{
      if (!deferredPrompt){ alert('Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¸Ù‡Ø± Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØªØŒ Ø§Ø³ØªØ®Ø¯Ù… "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙØ­.'); return; }
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
    });
  </script>
</body>
</html>
