<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª</title>
<style>
  :root{--bg:#eef6ff;--card:#fff;--text:#1b2a41;--muted:#5f6b7a;--shadow:0 1px 4px rgba(0,0,0,.12);--brand:#1e88e5;--now:#13b38b;--accent:#0ea5e9;}
  html,body{height:100%}
  body{margin:14px;background:var(--bg);font-family:Tahoma,Arial,sans-serif;color:var(--text)}
  .wrap{max-width:1000px;margin:0 auto}
  header{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin-bottom:10px}
  h1{font-size:20px;margin:0}
  .row{display:flex;gap:10px;align-items:center}
  select,button,input[type="text"]{border:1px solid #cfd8e3;background:#fff;border-radius:8px;padding:8px 10px;cursor:pointer}
  .primary{background:var(--brand);color:#fff;border:none}
  .card{background:var(--card);box-shadow:var(--shadow);border-radius:12px;padding:12px;margin:12px 0}
  .muted{color:var(--muted);font-size:12px}
  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
  .tab{padding:8px 12px;border-radius:10px;border:1px solid #cfd8e3;background:#fff;cursor:pointer}
  .tab.active{background:var(--accent);border-color:var(--accent);color:#fff}

  /* plan */
  .task{display:flex;align-items:center;justify-content:space-between;padding:12px;border:1px solid #e9eef5;border-radius:10px;margin:8px 0}
  .left{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .time{font-weight:bold;min-width:150px}
  .badge{font-size:12px;background:#e8f1ff;border:1px solid #cfe0ff;border-radius:999px;padding:4px 8px}
  .now{border-color:var(--now);box-shadow:0 0 0 2px rgba(19,179,139,.15)}
  .now .badge{background:#e9fff7;border-color:#b9f1df}
  .nowTag{font-size:12px;color:#0f8a6a;margin-inline-start:6px}
  .done{text-decoration:line-through;color:#777}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;margin-bottom:8px}
  .status{min-height:18px;margin-top:6px}
  input[type="checkbox"]{width:20px;height:20px;accent-color:var(--brand)}
  @media (max-width:560px){.time{min-width:auto}}

  /* adhkar */
  .dhk{border:1px solid #e6ebf2;border-radius:10px;padding:12px;margin:10px 0}
  .dhk h4{margin:0 0 8px 0;font-size:16px}
  .dhk .controls{display:flex;gap:6px;align-items:center;flex-wrap:wrap;margin-top:6px}
  .counter{min-width:42px;text-align:center;border-radius:8px;border:1px solid #cfd8e3;padding:4px 8px}
  .tag{display:inline-block;font-size:12px;background:#fafafa;border:1px solid #e8e8e8;border-radius:999px;padding:2px 8px;margin-inline-start:6px}

  /* quran */
  .qrow{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
  .ayah{padding:10px 12px;border-bottom:1px solid #eef2f7;line-height:1.9}
  .ayah .meta{font-size:12px;color:#6b7280}
  .ayah .num{display:inline-block;background:#eef6ff;border:1px solid #cfe0ff;border-radius:999px;padding:2px 8px;margin-inline:6px}
  .alt{margin-top:6px;color:#374151}
  .qtools{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
  .danger{background:#ef4444;color:#fff;border:none}
  .success{background:#10b981;color:#fff;border:none}
  .search{flex:1;min-width:180px}
  .stickyTop{position:sticky;top:8px;z-index:5}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1 id="title">ğŸ•°ï¸ Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª Ø¹Ù„Ù‰ Ù…Ù†Ù‡Ø¬ Ø§Ù„Ù†Ø¨ÙŠ ï·º</h1>
    <div class="row">
      <label for="lang" id="langLabel">Ø§Ù„Ù„ØºØ©:</label>
      <select id="lang">
        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
        <option value="fr">FranÃ§ais</option>
        <option value="en">English</option>
      </select>
      <button id="notifyBtn" class="primary">ğŸ”” ÙØ¹Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" data-page="plan" id="tab-plan">ğŸ“‹ Ø§Ù„ØªØ®Ø·ÙŠØ·</button>
    <button class="tab" data-page="adhkar" id="tab-adhkar">ğŸ•¯ï¸ Ø§Ù„Ø£Ø°ÙƒØ§Ø±</button>
    <button class="tab" data-page="quran" id="tab-quran">ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù†</button>
  </div>

  <!-- PLAN -->
  <section id="page-plan" class="card">
    <div class="toolbar">
      <button id="checkAll" class="primary">âœ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
      <button id="uncheckAll">â†©ï¸ Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
      <button id="resetDay">ğŸ—“ï¸ ØªØµÙÙŠØ± Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</button>
    </div>
    <div id="tasks"></div>
    <div id="progress" class="status muted"></div>
  </section>

  <!-- ADHKAR -->
  <section id="page-adhkar" class="card" style="display:none">
    <div class="qrow">
      <label for="slotSel" id="slotLabel">Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©:</label>
      <select id="slotSel"></select>
      <button id="resetAdhkar" class="primary">â†º ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>
    <div id="adhkarList"></div>
    <p class="muted" id="adhkarHint">ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ Ù„ÙƒÙ„ ÙØªØ±Ø© ÙˆÙ„ØºØ©.</p>
  </section>

  <!-- QURAN -->
  <section id="page-quran" class="card" style="display:none">
    <div class="qrow stickyTop">
      <label id="qLabel1">Ø³ÙˆØ±Ø©:</label>
      <select id="surahSel"></select>
      <label id="qLabel2">ØªØ±Ø¬Ù…Ø©:</label>
      <select id="trSel">
        <option value="none">â€”</option>
        <option value="fr.hamidullah">FranÃ§ais (Hamidullah)</option>
        <option value="en.sahih">English (Sahih)</option>
      </select>
      <input id="qSearch" class="search" type="text" placeholder="Ø¨Ø­Ø« / Search" />
      <button id="loadSurah" class="primary">ØªØ­Ù…ÙŠÙ„</button>
      <button id="backTop" class="success">â¬†ï¸ Haut / Ø£Ø¹Ù„Ù‰</button>
      <button id="clearCache" class="danger">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚Øª</button>
    </div>
    <div class="muted" id="readStatus"></div>
    <div id="qList"></div>
    <p class="muted" id="qHint">ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù†Øµ Ù…Ù† api.alquran.cloud ÙˆÙŠÙØ­ÙØ¸ Ù…Ø¤Ù‚ØªÙ‹Ø§ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ù„Ù„ØªØµÙØ­ Ø§Ù„Ø³Ø±ÙŠØ¹.</p>
  </section>

  <p class="muted" id="hint">
    Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØªÙ… Ø­ÙØ¸ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙŠÙˆÙ…ÙŠÙ‹Ø§. ØªØºÙŠÙ‘Ø± Ø§Ù„Ù„ØºØ© ÙŠØºÙŠÙ‘Ø± Ø£ÙŠØ¶Ù‹Ø§ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø© ÙˆÙ†ØµÙˆØµ Ø§Ù„Ù…Ù‡Ø§Ù….
  </p>
</div>

<script>
/* ================= i18n data (abrÃ©gÃ© pour la rÃ©ponse) ================= */
const T = {
  ar:{ title:"ğŸ•°ï¸ Ø¬Ø¯ÙˆÙ„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª Ø¹Ù„Ù‰ Ù…Ù†Ù‡Ø¬ Ø§Ù„Ù†Ø¨ÙŠ ï·º", lang:"Ø§Ù„Ù„ØºØ©:", notify:"ğŸ”” ÙØ¹Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",
    tabs:{plan:"ğŸ“‹ Ø§Ù„ØªØ®Ø·ÙŠØ·", adhkar:"ğŸ•¯ï¸ Ø§Ù„Ø£Ø°ÙƒØ§Ø±", quran:"ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù†"},
    checkAll:"âœ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„", uncheckAll:"â†©ï¸ Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„", resetDay:"ğŸ—“ï¸ ØªØµÙÙŠØ± Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…",
    hint:"Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØªÙ… Ø­ÙØ¸ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙŠÙˆÙ…ÙŠÙ‹Ø§. ØªØºÙŠÙ‘Ø± Ø§Ù„Ù„ØºØ© ÙŠØºÙŠÙ‘Ø± Ø£ÙŠØ¶Ù‹Ø§ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø© ÙˆÙ†ØµÙˆØµ Ø§Ù„Ù…Ù‡Ø§Ù….",
    notified:"âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª", noNotif:"ğŸš« Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",
    now:"Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ù‡Ù†Ø§", interval:(a,b)=>`${a} â€“ ${b}`,
    tasks:[
      {start:"04:30", end:"05:30", time:"Ù‚Ø¨Ù„ Ø§Ù„ÙØ¬Ø±", action:"Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„ ÙˆØ°ÙƒØ± Ø§Ù„Ù„Ù‡"},
      {start:"05:30", end:"07:00", time:"Ø§Ù„ÙØ¬Ø± â€“ Ø§Ù„Ø´Ø±ÙˆÙ‚", action:"ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± + Ø°ÙƒØ± ÙˆÙ‚Ø±Ø¢Ù†"},
      {start:"07:00", end:"10:00", time:"Ø§Ù„ØµØ¨Ø§Ø­", action:"Ø¹Ù…Ù„/Ø¯Ø±Ø§Ø³Ø© Ø¨Ù†ÙŠØ© Ù„Ù„Ù‡"},
      {start:"10:00", end:"12:30", time:"Ø§Ù„Ø¶Ø­Ù‰", action:"Ø±ÙƒØ¹ØªØ§Ù† Ø£Ùˆ Ø£Ø±Ø¨Ø¹"},
      {start:"12:30", end:"15:30", time:"Ø§Ù„Ø¸Ù‡Ø±", action:"ØµÙ„Ø§Ø© + Ù‚ÙŠÙ„ÙˆÙ„Ø©"},
      {start:"15:30", end:"18:30", time:"Ø§Ù„Ø¹ØµØ± â€“ Ø§Ù„Ù…ØºØ±Ø¨", action:"Ø¹Ù…Ù„/Ø¹Ù„Ù… + Ø±ÙŠØ§Ø¶Ø©"},
      {start:"18:30", end:"21:00", time:"Ø§Ù„Ù…ØºØ±Ø¨ â€“ Ø§Ù„Ø¹Ø´Ø§Ø¡", action:"Ø¬Ù„Ø³Ø© Ø¹Ø§Ø¦Ù„ÙŠØ© + Ù‚Ø±Ø¢Ù†"},
      {start:"21:00", end:"23:00", time:"Ø§Ù„Ø¹Ø´Ø§Ø¡", action:"ØµÙ„Ø§Ø© + Ø±Ø§Ø­Ø©/Ù…Ø·Ø§Ù„Ø¹Ø©"},
      {start:"23:00", end:"04:30", time:"Ø§Ù„Ù„ÙŠÙ„", action:"Ù†ÙˆÙ… Ù…Ø¨ÙƒØ± + Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„"}
    ],
    progress:(d,t)=>`Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…: ${d}/${t} (${Math.round(d*100/t)}%)`,
    slotLabel:"Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø©:", adhkarHint:"ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ Ù„ÙƒÙ„ ÙØªØ±Ø© ÙˆÙ„ØºØ©.", resetAdhkar:"â†º ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª",
    slots:[{key:"morning",name:"Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­"},{key:"afterPrayer",name:"Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„ÙˆØ§Øª"},{key:"evening",name:"Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡"},{key:"sleep",name:"Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…"}],
    adhkar:{ morning:[{txt:"Ø£ØµØ¨Ø­Ù†Ø§ ÙˆØ£ØµØ¨Ø­ Ø§Ù„Ù…Ù„Ùƒ Ù„Ù„Ù‡â€¦",count:1,ref:"Ù…Ø³Ù„Ù…"},{txt:"Ø³ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØºÙØ§Ø±â€¦",count:1,ref:"Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ"}],
             afterPrayer:[{txt:"Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ (Ù£)â€¦",count:1,ref:"Ù…Ø³Ù„Ù…"}],
             evening:[{txt:"Ø£Ù…Ø³ÙŠÙ†Ø§ ÙˆØ£Ù…Ø³Ù‰ Ø§Ù„Ù…Ù„Ùƒ Ù„Ù„Ù‡â€¦",count:1,ref:"Ù…Ø³Ù„Ù…"}],
             sleep:[{txt:"Ø¨Ø§Ø³Ù…Ùƒ Ø§Ù„Ù„Ù‡Ù… Ø£Ù…ÙˆØª ÙˆØ£Ø­ÙŠØ§",count:1,ref:"Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ"}] },
    qLabel1:"Ø³ÙˆØ±Ø©:", qLabel2:"ØªØ±Ø¬Ù…Ø©:", load:"ØªØ­Ù…ÙŠÙ„", back:"â¬†ï¸ Ø£Ø¹Ù„Ù‰", clear:"ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚Øª",
    searchPh:"Ø¨Ø­Ø« / Search", readSaved:s=>s
  },
  fr:{ title:"ğŸ•°ï¸ Planning dâ€™adorations â€“ MÃ©thode prophÃ©tique ï·º", lang:"Langue :", notify:"ğŸ”” Activer les notifications",
    tabs:{plan:"ğŸ“‹ Planning", adhkar:"ğŸ•¯ï¸ AdhkÃ¢r", quran:"ğŸ“– Coran"},
    checkAll:"âœ… Tout cocher", uncheckAll:"â†©ï¸ Tout dÃ©cocher", resetDay:"ğŸ—“ï¸ RÃ©initialiser la journÃ©e",
    hint:"Astuce : donnÃ©es enregistrÃ©es localement par jour. Le changement de langue adapte texte et sens.",
    notified:"âœ… Notifications activÃ©es", noNotif:"ğŸš« Notifications non supportÃ©es",
    now:"Vous Ãªtes ici", interval:(a,b)=>`${a} â€“ ${b}`,
    tasks:[
      {start:"04:30", end:"05:30", time:"Avant lâ€™aube", action:"QiyÃ¢m & rappels"},
      {start:"05:30", end:"07:00", time:"Fajr â€“ Lever du soleil", action:"Fajr + Coran & invocations"},
      {start:"07:00", end:"10:00", time:"Matin", action:"Travail/Ã‰tudes (intention)"},
      {start:"10:00", end:"12:30", time:"Duha", action:"2 Ã  4 unitÃ©s"},
      {start:"12:30", end:"15:30", time:"Dhuhr", action:"PriÃ¨re + sieste"},
      {start:"15:30", end:"18:30", time:"â€˜Asr â€“ Maghrib", action:"Travail/Savoir + Sport"},
      {start:"18:30", end:"21:00", time:"Maghrib â€“ â€˜Isha", action:"Famille + Coran"},
      {start:"21:00", end:"23:00", time:"â€˜Isha", action:"PriÃ¨re + Lecture"},
      {start:"23:00", end:"04:30", time:"Nuit", action:"Coucher tÃ´t + QiyÃ¢m"}
    ],
    progress:(d,t)=>`Progression : ${d}/${t} (${Math.round(d*100/t)}%)`,
    slotLabel:"Choisir un crÃ©neau :", adhkarHint:"Compteurs enregistrÃ©s localement.", resetAdhkar:"â†º RÃ©initialiser",
    slots:[{key:"morning",name:"AdhkÃ¢r du matin"},{key:"afterPrayer",name:"AprÃ¨s les priÃ¨res"},{key:"evening",name:"AdhkÃ¢r du soir"},{key:"sleep",name:"Avant de dormir"}],
    adhkar:{ morning:[{txt:"Nous entrons au matinâ€¦",count:1,ref:"Muslim"}], afterPrayer:[{txt:"Istighfar (3)â€¦",count:1,ref:"Muslim"}],
             evening:[{txt:"Nous entrons au soirâ€¦",count:1,ref:"Muslim"}], sleep:[{txt:"Bismika Allahummaâ€¦",count:1,ref:"Bukhari"}]},
    qLabel1:"Sourate :", qLabel2:"Traduction :", load:"Charger", back:"â¬†ï¸ Haut", clear:"ğŸ—‘ï¸ Vider le cache",
    searchPh:"Rechercher", readSaved:s=>`DerniÃ¨re lecture : ${s}`
  },
  en:{ title:"ğŸ•°ï¸ Time Management â€“ Prophetic Way ï·º", lang:"Language:", notify:"ğŸ”” Enable notifications",
    tabs:{plan:"ğŸ“‹ Plan", adhkar:"ğŸ•¯ï¸ Adhkar", quran:"ğŸ“– Quran"},
    checkAll:"âœ… Check all", uncheckAll:"â†©ï¸ Uncheck all", resetDay:"ğŸ—“ï¸ Reset today",
    hint:"Tip: data is stored locally per day. Language also flips layout.",
    notified:"âœ… Notifications enabled", noNotif:"ğŸš« Notifications not supported",
    now:"You are here", interval:(a,b)=>`${a} â€“ ${b}`,
    tasks:[
      {start:"04:30", end:"05:30", time:"Before Fajr", action:"Qiyam & remembrance"},
      {start:"05:30", end:"07:00", time:"Fajr â€“ Sunrise", action:"Fajr + Qurâ€™an & adhkar"},
      {start:"07:00", end:"10:00", time:"Morning", action:"Work/Study (intention)"},
      {start:"10:00", end:"12:30", time:"Duha", action:"2â€“4 units"},
      {start:"12:30", end:"15:30", time:"Dhuhr", action:"Prayer + short nap"},
      {start:"15:30", end:"18:30", time:"Asr â€“ Maghrib", action:"Work/Exercise"},
      {start:"18:30", end:"21:00", time:"Maghrib â€“ Isha", action:"Family + Qurâ€™an"},
      {start:"21:00", end:"23:00", time:"Isha", action:"Prayer + Reading"},
      {start:"23:00", end:"04:30", time:"Night", action:"Sleep early + Qiyam"}
    ],
    progress:(d,t)=>`Today: ${d}/${t} (${Math.round(d*100/t)}%)`,
    slotLabel:"Choose slot:", adhkarHint:"Counters saved locally.", resetAdhkar:"â†º Reset",
    slots:[{key:"morning",name:"Morning adhkar"},{key:"afterPrayer",name:"After prayers"},{key:"evening",name:"Evening adhkar"},{key:"sleep",name:"Before sleep"}],
    adhkar:{ morning:[{txt:"We enter the morningâ€¦",count:1,ref:"Muslim"}], afterPrayer:[{txt:"Istighfar (3)â€¦",count:1,ref:"Muslim"}],
             evening:[{txt:"We enter the eveningâ€¦",count:1,ref:"Muslim"}], sleep:[{txt:"Bismika Allahummaâ€¦",count:1,ref:"Bukhari"}]},
    qLabel1:"Surah:", qLabel2:"Translation:", load:"Load", back:"â¬†ï¸ Top", clear:"ğŸ—‘ï¸ Clear cache",
    searchPh:"Search", readSaved:s=>`Last read: ${s}`
  }
};

const SURAH_NAMES = [
 "Al-FÄtiá¸¥ah","Al-Baqarah","Ä€l â€˜ImrÄn","An-NisÄâ€™","Al-MÄâ€™idah","Al-Anâ€˜Äm","Al-Aâ€˜rÄf","Al-AnfÄl","At-Tawbah","YÅ«nus",
 "HÅ«d","YÅ«suf","Ar-Raâ€˜d","IbrÄhÄ«m","Al-á¸¤ijr","An-Naá¸¥l","Al-IsrÄâ€™","Al-Kahf","Maryam","á¹¬Ä HÄ",
 "Al-AnbiyÄâ€™","Al-á¸¤ajj","Al-Muâ€™minÅ«n","An-NÅ«r","Al-FurqÄn","Ash-Shuâ€˜arÄâ€™","An-Naml","Al-Qaá¹£aá¹£","Al-â€˜AnkabÅ«t","Ar-RÅ«m",
 "LuqmÄn","As-Sajdah","Al-Aá¸¥zÄb","Sabaâ€™","FÄá¹­ir","YÄ SÄ«n","As-á¹¢ÄffÄt","á¹¢Äd","Az-Zumar","GhÄfir",
 "Fuá¹£á¹£ilat","Ash-ShÅ«rÄ","Az-Zukhruf","Ad-DukhÄn","Al-JÄØ«iyah","Al-Aá¸¥qÄf","Muá¸¥ammad","Al-Fatá¸¥","Al-á¸¤ujurÄt","QÄf",
 "Adh-DhÄriyÄt","Aá¹­-á¹¬Å«r","An-Najm","Al-Qamar","Ar-Raá¸¥mÄn","Al-WÄqiâ€˜ah","Al-á¸¤adÄ«d","Al-MujÄdilah","Al-á¸¤ashr","Al-Mumtaá¸¥anah",
 "Aá¹£-á¹¢aff","Al-Jumuâ€˜ah","Al-MunÄfiqÅ«n","At-TaghÄbun","Aá¹­-á¹¬alÄq","At-Taá¸¥rÄ«m","Al-Mulk","Al-Qalam","Al-á¸¤Äqqah","Al-Maâ€˜Ärij",
 "NÅ«á¸¥","Al-Jinn","Al-Muzzammil","Al-Muddaththir","Al-QiyÄmah","Al-InsÄn","Al-MursalÄt","An-Nabaâ€™","An-NÄziâ€˜Ät","â€˜Abasa",
 "At-TakwÄ«r","Al-Infiá¹­Är","Al-Muá¹­affifÄ«n","Al-InshiqÄq","Al-BurÅ«j","Aá¹­-á¹¬Äriq","Al-Aâ€˜lÄ","Al-GhÄshiyah","Al-Fajr","Al-Balad",
 "Ash-Shams","Al-Layl","Aá¸-á¸Œuá¸¥Ä","Ash-Shará¸¥","At-TÄ«n","Al-â€˜Alaq","Al-Qadr","Al-Bayyinah","Az-Zalzalah","Al-â€˜Ä€diyÄt",
 "Al-QÄriâ€˜ah","At-TakÄthur","Al-â€˜Aá¹£r","Al-Humazah","Al-FÄ«l","Quraysh","Al-MÄâ€˜Å«n","Al-Kawthar","Al-KÄfirÅ«n","An-Naá¹£r",
 "Al-Masad","Al-IkhlÄá¹£","Al-Falaq","An-NÄs"
];

/* ================ helpers / storage ================ */
const $ = s => document.querySelector(s);
const todayKey = () => new Date().toISOString().slice(0,10);
const prefLangKey = "pref_lang";
const planKey = lang => `done_${todayKey()}_${lang}`;
const adhKey = (lang,slot)=>`adhkar_${todayKey()}_${lang}_${slot}`;

function loadJSON(k){ try{return JSON.parse(localStorage.getItem(k)||"{}");}catch{return{}} }
function saveJSON(k,v){ localStorage.setItem(k, JSON.stringify(v)); }

/* ================ elements ================ */
const titleEl=$("#title"), langSel=$("#lang"), notifyBtn=$("#notifyBtn"),
      tabPlan=$("#tab-plan"), tabAdhkar=$("#tab-adhkar"), tabQuran=$("#tab-quran"),
      pagePlan=$("#page-plan"), pageAdhkar=$("#page-adhkar"), pageQuran=$("#page-quran"),
      hintEl=$("#hint");

const checkAllBtn=$("#checkAll"), uncheckAllBtn=$("#uncheckAll"), resetDayBtn=$("#resetDay"),
      tasksEl=$("#tasks"), progressEl=$("#progress");

const slotLabel=$("#slotLabel"), slotSel=$("#slotSel"), adhkarList=$("#adhkarList"),
      resetAdhkar=$("#resetAdhkar"), adhkarHint=$("#adhkarHint");

const qLabel1=$("#qLabel1"), qLabel2=$("#qLabel2"), surahSel=$("#surahSel"),
      trSel=$("#trSel"), qSearch=$("#qSearch"), loadSurahBtn=$("#loadSurah"),
      backTop=$("#backTop"), clearCache=$("#clearCache"), qList=$("#qList"),
      readStatus=$("#readStatus"), qHint=$("#qHint");

/* ================ time utils ================ */
function timeToDate(hhmm){ const [h,m]=hhmm.split(":").map(Number); const n=new Date(); return new Date(n.getFullYear(),n.getMonth(),n.getDate(),h,m,0,0); }
function isNowInInterval(start,end){ const now=new Date(); let s=timeToDate(start), e=timeToDate(end); if(e<=s) e=new Date(e.getTime()+86400000); let n=now; if(now<s && e-s>43200000) n=new Date(now.getTime()+86400000); return n>=s && n<e; }

/* ================ PLAN ================ */
function renderPlan(lang,L){
  $("#tab-plan").textContent=L.tabs.plan;
  checkAllBtn.textContent=L.checkAll; uncheckAllBtn.textContent=L.uncheckAll; resetDayBtn.textContent=L.resetDay;

  const dm=loadJSON(planKey(lang)); tasksEl.innerHTML="";
  L.tasks.forEach((t,i)=>{
    const checked=!!dm[i]; const nowTag=isNowInInterval(t.start,t.end)?`<span class="nowTag">â€¢ ${L.now}</span>`:"";
    const row=document.createElement("div"); row.className="task"; if(nowTag) row.classList.add("now");
    row.innerHTML=`<div class="left">
      <input type="checkbox" id="chk-${i}" ${checked?"checked":""}/>
      <span class="time">${t.time}:</span>
      <span id="txt-${i}" class="${checked?"done":""}">${t.action}</span>
      <span class="badge">${L.interval(t.start,t.end)}</span>${nowTag}
    </div>`;
    tasksEl.appendChild(row);
  });
  L.tasks.forEach((_,i)=>{
    $("#chk-"+i).addEventListener("change",e=>{
      const m=loadJSON(planKey(lang)); m[i]=e.target.checked; saveJSON(planKey(lang),m);
      $("#txt-"+i).classList.toggle("done",e.target.checked); updateProgress(lang,L);
    })
  });
  updateProgress(lang,L);
}
function updateProgress(lang,L){ const m=loadJSON(planKey(lang)); const total=L.tasks.length, done=Object.values(m).filter(Boolean).length; progressEl.textContent=L.progress(done,total); }

/* ================ ADHKAR ================ */
function renderAdhkar(lang,L){
  $("#tab-adhkar").textContent=L.tabs.adhkar;
  slotLabel.textContent=L.slotLabel; resetAdhkar.textContent=L.resetAdhkar; adhkarHint.textContent=L.adhkarHint;
  slotSel.innerHTML=""; L.slots.forEach(s=>{const o=document.createElement("option"); o.value=s.key; o.textContent=s.name; slotSel.appendChild(o);});
  const cur=localStorage.getItem("adh_slot_"+lang)||L.slots[0].key; slotSel.value=cur;
  drawAdhkarList(lang,cur,L.adhkar[cur]||[]);
  slotSel.onchange=()=>{localStorage.setItem("adh_slot_"+lang,slotSel.value); drawAdhkarList(lang,slotSel.value,L.adhkar[slotSel.value]||[]);};
  resetAdhkar.onclick=()=>{localStorage.removeItem(adhKey(lang,slotSel.value)); drawAdhkarList(lang,slotSel.value,L.adhkar[slotSel.value]||[]);};
}
function drawAdhkarList(lang,slot,list){
  adhkarList.innerHTML=""; const counts=loadJSON(adhKey(lang,slot));
  list.forEach((d,i)=>{
    const need=d.count||1, cur=counts[i]||0; const div=document.createElement("div"); div.className="dhk";
    div.innerHTML=`<h4>${d.txt}</h4><p class="muted">${d.ref?`<span class="tag">${d.ref}</span>`:""}<span class="tag">x${need}</span></p>
      <div class="controls">
        <button class="primary" id="p${i}">+1</button><button id="m${i}">-1</button>
        <span class="counter" id="c${i}">${cur}/${need}</span>
        <button id="d${i}">âœ…</button><button id="r${i}">â†º</button>
      </div>`;
    adhkarList.appendChild(div);
    const up=v=>{const x=Math.max(0,Math.min(need,v)); counts[i]=x; saveJSON(adhKey(lang,slot),counts); $("#c"+i).textContent=`${x}/${need}`;}
    $("#p"+i).onclick=()=>up((counts[i]||0)+1); $("#m"+i).onclick=()=>up((counts[i]||0)-1); $("#d"+i).onclick=()=>up(need); $("#r"+i).onclick=()=>up(0);
  });
}

/* ================ QURAN (full surah loader) ================ */
// cache local (par jour) pour aller vite une fois chargÃ©
const Q_CACHE_KEY = (surah,edition)=>`qcache_${todayKey()}_${edition}_${surah}`;

// rÃ©cupÃ¨re une Ã©dition (arabe ou traduction) puis renvoie array dâ€™ayahs
async function fetchEdition(surah, edition){
  const k=Q_CACHE_KEY(surah,edition);
  const cached = localStorage.getItem(k);
  if(cached){ try{return JSON.parse(cached);}catch{} }
  const url=`https://api.alquran.cloud/v1/surah/${surah}/${edition}`;
  const res=await fetch(url);
  if(!res.ok) throw new Error("API error");
  const data=await res.json();
  const ayat = (data?.data?.ayahs||[]).map(a=>({n:a.numberInSurah, text:a.text}));
  localStorage.setItem(k, JSON.stringify(ayat));
  return ayat;
}

function setupQuranUI(lang,L){
  $("#tab-quran").textContent=L.tabs.quran;
  qLabel1.textContent=L.qLabel1; qLabel2.textContent=L.qLabel2;
  qSearch.placeholder=L.searchPh;
  qHint.textContent = (lang==="fr") ? "Le texte est chargÃ© depuis api.alquran.cloud et mis en cache local."
                    : (lang==="en") ? "Text is fetched from api.alquran.cloud and cached locally."
                    : "ÙŠØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù†Øµ Ù…Ù† api.alquran.cloud ÙˆØªØ®Ø²ÙŠÙ†Ù‡ Ù…Ø¤Ù‚ØªÙ‹Ø§ Ù…Ø­Ù„ÙŠÙ‹Ø§.";
  // remplir la liste des sourates
  surahSel.innerHTML=""; SURAH_NAMES.forEach((nm,i)=>{const o=document.createElement("option"); o.value=String(i+1); o.textContent=`${i+1}. ${nm}`; surahSel.appendChild(o);});
  // traduction par dÃ©faut selon langue UI
  trSel.value = (lang==="fr") ? "fr.hamidullah" : (lang==="en" ? "en.sahih" : "none");
}

async function loadSurah(lang){
  const L=T[lang]; const s=surahSel.value; const tr=trSel.value; qList.innerHTML=""; readStatus.textContent="";
  // arabic uthmani
  let arAyat=[], trAyat=null, err=false;
  try{ arAyat = await fetchEdition(s,"quran-uthmani"); } catch(e){ err=true; qList.innerHTML = `<p class="muted">âš ï¸ ${lang==='fr'?'Erreur de chargement du texte arabe':'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ'}</p>`; }
  if(tr!=="none"){
    try{ trAyat = await fetchEdition(s,tr); } catch(e){ /* ignore translation error */ }
  }
  // rendu
  if(arAyat.length){
    const frag = document.createDocumentFragment();
    arAyat.forEach((a,idx)=>{
      const div=document.createElement("div"); div.className="ayah";
      const trLine = (trAyat && trAyat[idx]) ? `<div class="alt">${trAyat[idx].text}</div>` : "";
      div.innerHTML = `<div class="meta"><span class="num">${a.n}</span></div><div class="ar">${a.text}</div>${trLine}`;
      frag.appendChild(div);
    });
    qList.appendChild(frag);
    readStatus.textContent = L.readSaved(`Surah ${s} â€” ${arAyat.length} ayat`);
  } else if(!err){
    qList.innerHTML = `<p class="muted">ğŸ˜• ${lang==='fr'?'Aucune donnÃ©e reÃ§ue':'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'}</p>`;
  }
}

function filterAyat(){
  const term = qSearch.value.trim();
  const items = qList.querySelectorAll(".ayah");
  if(!term){ items.forEach(el=>el.style.display=""); return; }
  const t = term.toLowerCase();
  items.forEach(el=>{
    const txt = el.textContent.toLowerCase();
    el.style.display = txt.includes(t) ? "" : "none";
  });
}

/* ================ NAV / LANG / INIT ================ */
function showPage(key){
  [pagePlan,pageAdhkar,pageQuran].forEach(p=>p.style.display="none");
  [tabPlan,tabAdhkar,tabQuran].forEach(t=>t.classList.remove("active"));
  if(key==="plan"){ pagePlan.style.display="block"; tabPlan.classList.add("active"); }
  if(key==="adhkar"){ pageAdhkar.style.display="block"; tabAdhkar.classList.add("active"); }
  if(key==="quran"){ pageQuran.style.display="block"; tabQuran.classList.add("active"); }
  localStorage.setItem("last_page", key);
}

function renderAll(lang){
  const rtl = (lang==="ar"); const L=T[lang];
  document.documentElement.lang=lang; document.documentElement.dir=rtl?"rtl":"ltr"; document.body.style.direction=rtl?"rtl":"ltr";
  titleEl.textContent=L.title; $("#langLabel").textContent=L.lang; notifyBtn.textContent=L.notify; hintEl.textContent=L.hint;
  tabPlan.textContent=L.tabs.plan; tabAdhkar.textContent=L.tabs.adhkar; tabQuran.textContent=L.tabs.quran;
  renderPlan(lang,L); renderAdhkar(lang,L); setupQuranUI(lang,L);
}

/* notifications */
function enableNotifications(L){
  if(!("Notification" in window)){ alert(L.noNotif); return; }
  if(Notification.permission==="granted"){ new Notification(L.notified); }
  else if(Notification.permission!=="denied"){
    Notification.requestPermission().then(p=>{ if(p==="granted") new Notification(L.notified); });
  }
}

document.addEventListener("DOMContentLoaded", ()=>{
  const initLang=localStorage.getItem(prefLangKey)||"ar"; langSel.value=initLang; renderAll(initLang);
  showPage(localStorage.getItem("last_page")||"plan");
  setInterval(()=>renderPlan(langSel.value,T[langSel.value]), 60000);

  langSel.addEventListener("change", ()=>{ const lang=langSel.value; localStorage.setItem(prefLangKey,lang); renderAll(lang); });
  notifyBtn.addEventListener("click", ()=>enableNotifications(T[langSel.value]));
  checkAllBtn.addEventListener("click", ()=>{ const L=T[langSel.value], m={}; L.tasks.forEach((_,i)=>m[i]=true); saveJSON(planKey(langSel.value),m); renderPlan(langSel.value,L); });
  uncheckAllBtn.addEventListener("click", ()=>{ const L=T[langSel.value], m={}; L.tasks.forEach((_,i)=>m[i]=false); saveJSON(planKey(langSel.value),m); renderPlan(langSel.value,L); });
  resetDayBtn.addEventListener("click", ()=>{ localStorage.removeItem(planKey(langSel.value)); renderPlan(langSel.value,T[langSel.value]); });

  tabPlan.onclick=()=>showPage("plan"); tabAdhkar.onclick=()=>showPage("adhkar"); tabQuran.onclick=()=>showPage("quran");

  // Quran UI actions
  loadSurahBtn.addEventListener("click", ()=>loadSurah(langSel.value));
  qSearch.addEventListener("input", filterAyat);
  backTop.addEventListener("click", ()=>window.scrollTo({top:0,behavior:"smooth"}));
  clearCache.addEventListener("click", ()=>{
    const prefix=`qcache_${todayKey()}_`;
    Object.keys(localStorage).forEach(k=>{ if(k.startsWith(prefix)) localStorage.removeItem(k); });
    qList.innerHTML = `<p class="muted">ğŸ—‘ï¸ Cache vidÃ©.</p>`;
  });
});
</script>
</body>
</html>
