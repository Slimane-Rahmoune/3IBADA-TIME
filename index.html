<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>جدول إدارة الوقت</title>
  <style>
    :root{--bg:#eef6ff;--card:#fff;--text:#1b2a41;--muted:#5f6b7a;--shadow:0 1px 4px rgba(0,0,0,.12);}
    html,body{height:100%}
    body{margin:14px;background:var(--bg);font-family:Tahoma,Arial,sans-serif;color:var(--text)}
    .wrap{max-width:820px;margin:0 auto}
    header{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:20px;margin:0}
    .row{display:flex;gap:10px;align-items:center}
    select,button{border:1px solid #cfd8e3;background:#fff;border-radius:8px;padding:8px 10px;cursor:pointer}
    .primary{background:#1e88e5;color:#fff;border:none}
    .card{background:var(--card);box-shadow:var(--shadow);border-radius:12px;padding:12px;margin:12px 0}
    .task{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid #f0f0f0}
    .task:last-child{border-bottom:none}
    .left{display:flex;gap:10px;align-items:center}
    .time{font-weight:bold;min-width:130px}
    .done{text-decoration:line-through;color:#777}
    .muted{color:var(--muted);font-size:12px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .status{min-height:18px;margin-top:6px}
    @media (max-width:520px){.time{min-width:auto}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1 id="title">🕰️ جدول إدارة الوقت على منهج النبي ﷺ</h1>
      <div class="row">
        <label for="lang" id="langLabel">اللغة:</label>
        <select id="lang">
          <option value="ar">العربية</option>
          <option value="fr">Français</option>
          <option value="en">English</option>
        </select>
        <button id="notifyBtn" class="primary">🔔 فعل الإشعارات</button>
      </div>
    </header>

    <div class="card">
      <div class="toolbar">
        <button id="checkAll" class="primary">✅ تحديد الكل</button>
        <button id="uncheckAll">↩️ إلغاء تحديد الكل</button>
        <button id="resetDay">🗓️ تصفير هذا اليوم</button>
      </div>
      <div id="tasks"></div>
      <div id="progress" class="status muted"></div>
    </div>

    <p class="muted" id="hint">
      ملاحظة: يتم حفظ إنجازاتك محليًا يوميًا. تغيّر اللغة يغيّر أيضًا اتجاه الصفحة ونصوص المهام.
    </p>
  </div>

  <script>
    // ======= i18n strings =======
    const T = {
      ar:{
        title:"🕰️ جدول إدارة الوقت على منهج النبي ﷺ",
        lang:"اللغة:",
        notify:"🔔 فعل الإشعارات",
        checkAll:"✅ تحديد الكل",
        uncheckAll:"↩️ إلغاء تحديد الكل",
        resetDay:"🗓️ تصفير هذا اليوم",
        hint:"ملاحظة: يتم حفظ إنجازاتك محليًا يوميًا. تغيّر اللغة يغيّر أيضًا اتجاه الصفحة ونصوص المهام.",
        notified:"✅ تم تفعيل الإشعارات",
        noNotif:"🚫 متصفحك لا يدعم الإشعارات",
        tasks:[
          {time:"قبل الفجر", action:"قيام الليل وذكر الله"},
          {time:"الفجر – الشروق", action:"صلاة الفجر + ذكر وقرآن"},
          {time:"الصباح", action:"عمل/دراسة بنيّة لله"},
          {time:"الضحى", action:"ركعتان أو أربع"},
          {time:"الظهر", action:"صلاة + قيلولة"},
          {time:"العصر – المغرب", action:"عمل/علم + رياضة"},
          {time:"المغرب – العشاء", action:"جلسة عائلية + قرآن"},
          {time:"العشاء", action:"صلاة + راحة/مطالعة"},
          {time:"الليل", action:"نوم مبكر + قيام الليل"}
        ],
        progress:(done,total)=>`إنجاز اليوم: ${done}/${total} (${Math.round(done*100/total)}%)`
      },
      fr:{
        title:"🕰️ Planning d’adorations – Méthode du Prophète ﷺ",
        lang:"Langue :",
        notify:"🔔 Activer les notifications",
        checkAll:"✅ Tout cocher",
        uncheckAll:"↩️ Tout décocher",
        resetDay:"🗓️ Réinitialiser la journée",
        hint:"Astuce : votre progression est enregistrée localement par jour. Changer de langue adapte aussi l’orientation et les textes.",
        notified:"✅ Notifications activées",
        noNotif:"🚫 Votre navigateur ne supporte pas les notifications",
        tasks:[
          {time:"Avant l’aube", action:"Qiyâm et rappel d’Allah"},
          {time:"Fajr – Lever du soleil", action:"Prière du Fajr + Coran & invocations"},
          {time:"Matin", action:"Travail/études avec intention sincère"},
          {time:"Duha", action:"2 à 4 unités de prière"},
          {time:"Dhuhr", action:"Prière + petite sieste"},
          {time:"‘Asr – Maghrib", action:"Travail/savoir + sport"},
          {time:"Maghrib – ‘Isha", action:"Temps familial + Coran"},
          {time:"‘Isha", action:"Prière + lecture/repos"},
          {time:"Nuit", action:"Coucher tôt + Qiyâm"}
        ],
        progress:(done,total)=>`Progression du jour : ${done}/${total} (${Math.round(done*100/total)}%)`
      },
      en:{
        title:"🕰️ Time Management (Prophetic Way)",
        lang:"Language:",
        notify:"🔔 Enable notifications",
        checkAll:"✅ Check all",
        uncheckAll:"↩️ Uncheck all",
        resetDay:"🗓️ Reset today",
        hint:"Tip: your progress is saved locally per day. Changing language also flips layout and texts.",
        notified:"✅ Notifications enabled",
        noNotif:"🚫 Your browser does not support Notifications",
        tasks:[
          {time:"Before Fajr", action:"Qiyam (night prayer) & remembrance"},
          {time:"Fajr – Sunrise", action:"Fajr prayer + Qur’an & adhkar"},
          {time:"Morning", action:"Work/Study with sincere intention"},
          {time:"Duha", action:"2–4 units of prayer"},
          {time:"Dhuhr", action:"Prayer + short nap"},
          {time:"Asr – Maghrib", action:"Work/Knowledge + Exercise"},
          {time:"Maghrib – Isha", action:"Family time + Qur’an"},
          {time:"Isha", action:"Prayer + Reading/Rest"},
          {time:"Night", action:"Sleep early + Qiyam"}
        ],
        progress:(done,total)=>`Today’s progress: ${done}/${total} (${Math.round(done*100/total)}%)`
      }
    };

    // ======= Elements =======
    const $ = sel => document.querySelector(sel);
    const tasksEl = $("#tasks");
    const titleEl = $("#title");
    const hintEl = $("#hint");
    const notifyBtn = $("#notifyBtn");
    const langSel = $("#lang");
    const checkAllBtn = $("#checkAll");
    const uncheckAllBtn = $("#uncheckAll");
    const resetDayBtn = $("#resetDay");
    const progressEl = $("#progress");

    // ======= State / storage keys =======
    const todayKey = () => new Date().toISOString().slice(0,10); // YYYY-MM-DD
    const lsKey = (lang) => `done_${todayKey()}_${lang}`;
    const langKey = "pref_lang";

    // ======= Render =======
    function render(lang){
      // direction & lang attr
      const rtl = (lang === "ar");
      document.documentElement.lang = lang;
      document.documentElement.dir = rtl ? "rtl" : "ltr";
      document.body.style.direction = rtl ? "rtl" : "ltr";

      const L = T[lang];
      titleEl.textContent = L.title;
      $("#langLabel").textContent = L.lang;
      notifyBtn.textContent = L.notify;
      checkAllBtn.textContent = L.checkAll;
      uncheckAllBtn.textContent = L.uncheckAll;
      resetDayBtn.textContent = L.resetDay;
      hintEl.textContent = L.hint;

      // load saved done map
      const saved = JSON.parse(localStorage.getItem(lsKey(lang)) || "{}");

      // build tasks
      tasksEl.innerHTML = "";
      L.tasks.forEach((t, i) => {
        const row = document.createElement("div");
        row.className = "task";
        row.innerHTML = `
          <div class="left">
            <input type="checkbox" id="chk-${i}" ${saved[i] ? "checked" : ""} />
            <span class="time">${t.time}</span>
            <span id="txt-${i}" class="${saved[i] ? "done" : ""}">${t.action}</span>
          </div>
          <div></div>
        `;
        tasksEl.appendChild(row);
      });

      // attach listeners to checkboxes
      L.tasks.forEach((_, i) => {
        $("#chk-"+i).addEventListener("change", e => {
          const map = JSON.parse(localStorage.getItem(lsKey(lang)) || "{}");
          const checked = e.target.checked;
          map[i] = checked;
          localStorage.setItem(lsKey(lang), JSON.stringify(map));
          $("#txt-"+i).classList.toggle("done", checked);
          updateProgress(lang);
        });
      });

      updateProgress(lang);
    }

    function updateProgress(lang){
      const L = T[lang];
      const map = JSON.parse(localStorage.getItem(lsKey(lang)) || "{}");
      const total = L.tasks.length;
      const done = Object.values(map).filter(Boolean).length;
      progressEl.textContent = L.progress(done, total);
    }

    // ======= Actions =======
    function enableNotifications(lang){
      const L = T[lang];
      if(!("Notification" in window)){
        alert(L.noNotif); return;
      }
      if(Notification.permission === "granted"){
        new Notification(L.notified);
      }else if(Notification.permission !== "denied"){
        Notification.requestPermission().then(p=>{
          if(p==="granted") new Notification(L.notified);
        });
      }
    }

    function checkAll(lang, value){
      const L = T[lang];
      const map = {};
      L.tasks.forEach((_, i)=>{
        const chk = $("#chk-"+i);
        const txt = $("#txt-"+i);
        chk.checked = value;
        txt.classList.toggle("done", value);
        map[i] = value;
      });
      localStorage.setItem(lsKey(lang), JSON.stringify(map));
      updateProgress(lang);
    }

    function resetToday(lang){
      localStorage.removeItem(lsKey(lang));
      render(lang);
    }

    // ======= Init =======
    document.addEventListener("DOMContentLoaded", ()=>{
      const initialLang = localStorage.getItem(langKey) || "ar";
      langSel.value = initialLang;
      render(initialLang);

      langSel.addEventListener("change", ()=>{
        const lang = langSel.value;
        localStorage.setItem(langKey, lang);
        render(lang);
      });

      notifyBtn.addEventListener("click", ()=> enableNotifications(langSel.value));
      checkAllBtn.addEventListener("click", ()=> checkAll(langSel.value, true));
      uncheckAllBtn.addEventListener("click", ()=> checkAll(langSel.value, false));
      resetDayBtn.addEventListener("click", ()=> resetToday(langSel.value));
    });
  </script>
</body>
</html>
